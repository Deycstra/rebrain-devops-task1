<h4 align="center">
  <img alt="OSPF" src="OSPF.jpg">
</h4>


#### Компоненты протокола OSPF
Все протоколы маршрутизации используют аналогичные компоненты. Все протоколы используют сообщения протокола маршрутизации для обмена данными маршрутизации. Сообщения позволяют выстраивать структуры данных, которые впоследствии обрабатываются посредством алгоритма маршрутизации.
Три основных компонента протокола маршрутизации OSPF:

##### Структуры данных

Протокол OSPF создает и обслуживает три базы данных:

* **База данных смежности** — создает таблицу соседних устройств.
* **База данных на основе состояния канала (LSDB)** — создает таблицу топологии.
* **База данных пересылки** — создает таблицу маршрутизации.

Эти таблицы содержат список соседних маршрутизаторов, между которыми выполняется обмен данными маршрутизации. Таблицы хранятся и обрабатываются в ОЗУ.

##### Маршрутизация сообщений протокола

Устройства 3-го уровня (такие, как маршрутизаторы) применяют сообщения обмена OSPF для переноса информации о маршрутах с использованием пяти типов пакетов. К таким пакетам относятся:

* **Hello** - пакет приветствия;
* **DBD** - пакет описания базы данных;
* **LSR** - пакет состояния канала;
* **LSU** - пакет обновления состояния канала;
* **LSAck** - пакет подтверждения состояния канала.

##### Структуры данных OSPF
| База данных | Таблица | Описание | 
|:-------------:|:---------:|:----------|
| База данных смежности                 | Таблица соседей       | <ul><li>Список всех соседних маршрутизаторов, с которыми установлен двусторонний обмен данными.</li><li>Для каждого маршрутизатора существует уникальная таблица.</li><li>Соседние устройства можно просмотреть с помощью команды `show ip ospf neighbor`.</li></ul> |
| База данных состояний каналов (LSDB)  | Таблица топологии     | <ul><li>Содержит данные обо всех маршрутизаторах в сети.</li><li>Эта база данных представляет топологию сети.</li><li>Все маршрутизаторы в области использу.т идентичные базы данных состояний каналов (LSDB).</li><li>Базу данных можно просмотреть с помощью команды `show ip ospf database`.</li></ul>|
| База данных пересылки                 | Таблица маршрутизации | <ul><li>Содержит данные о маршрутах, созданных при запуске алгоритма в базе данных состояний каналов.</li><li>Каждый маршрутизатор использует уникальную таблицу маршрутизации, которая содержит данные о способе и месте отправки пакетов на другие маршрутизаторы.</li><li>Маршруты можно просмотреть с помощью команды `show ip route`.</li></ul>|



Эти пакеты используются для обнаружения соседних маршрутизаторов, а также для обмена данными маршрутизации в целях предоставления точных данных о сети.

##### Алгоритм SPF
Маршрутизатор формирует таблицу топологии с использованием результатов вычислений, основанных на **алгоритме кратчайшего пути (SPF) Дейкстры**. Алгоритм поиска кратчайшего пути основывается на данных о совокупной стоимости доступа к точке назначения.
Алгоритм поиска кратчайшего пути создаёт дерево кратчайших путей SPF путём размещения каждого маршрутизатора в корне дерева и расчёта кратчайших путей к каждому из узлов. После этого дерево кратчайших путей SPF используется для расчёта оптимальных маршрутов. Протокол OSPF вносит оптимальные маршруты в базу данных пересылки, которая применяется для создания таблицы маршрутизации.

---

#### Принцип работы маршрутизации по состоянию канала
Для предоставления данных маршрутизации маршрутизаторы, использующие протокол OSPF, выполняют следующие общие этапы маршрутизации по состоянию канала для достижения состояния сходимости:

1. **Установление отношений смежности с соседними устройствами:** маршрутизаторы с поддержкой OSPF должны выполнить обнаружение друг друга в сети, чтобы обмениваться данными. Маршрутизатор, использующий OSPF, отправляет пакеты приветствия из всех интерфейсов с включенным OSPF для определения всех соседних устройств в пределах этих каналов. При наличии соседнего устройства маршрутизатор, использующий OSPF, пытается установить с ним отношения смежности.

2. **Обмен объявлениями о состоянии канала:** после установления отношений смежности маршрутизаторы выполняют обмен объявлениями о состоянии канала (LSA). LSA содержат информацию о состоянии и стоимости каждого канала с прямым подключением. Маршрутизаторы отправляют свои LSA смежным устройствам. При получении LSA смежные устройства мгновенно отправляют свои LSA соседям с прямым подключением, и так до тех пор, пока все маршрутизаторы области не получат все LSA.

3. **Создание таблицы топологии:** после получения объявлений о состоянии канала (LSA) маршрутизаторы, использующие OSPF, создают базу данных топологии на базе полученных пакетов. В этой базе данных в конечном итоге собирается вся информация о топологии сети.

4. **Выполнение алгоритма поиска кратчайшего пути SPF.** После этого маршрутизаторы выполняют алгоритм поиска кратчайшего пути. На рисунке с помощью шестерёнок обозначено выполнение алгоритма поиска кратчайшего пути. Алгоритм поиска кратчайшего пути создаёт дерево кратчайших путей SPF.

На основании данных дерева SPF предлагаются наилучшие пути для таблицы IP-маршрутизации. Маршрут добавляется в таблицу маршрутизации, если отсутствует источник маршрута к той же сети с меньшим административным расстоянием, например статический маршрут. Решения по маршрутизации принимаются на основе записей в таблице маршрутизации.


---

#### Рабочие состояния OSPF
При первом подключении маршрутизатора OSPF к сети он пытается:

* установить отношения смежности с соседними узлами;
* осуществить обмен данными маршрутизации;
* рассчитать оптимальные маршруты;
* достичь состояния сходимости.

Протокол OSPF проходит несколько состояний в процессе достижения сходимости:

- *Состояние* **Down**;
- *Состояние* **Init**;
- *Состояние* **Two-Way**
- *Состояние* **ExStart**;
- *Состояние* **Exchange**;
- *Состояние* **Loading**;
- *Состояние* **Full**.

---

### Конфигурирование протокола OSPF

##### Настройка идентификатора маршрутизатора OSPF
Для включения OSPFv2 используется команда:

    Router(config)# router ospf process-id
    
Значение *process-id* представляет число от 1 до 65 535 и выбирается сетевым администратором. Значение *process-id* используется локально, то есть оно не обязательно должно совпадать с соответствующим значением на других маршрутизаторах OSPF, чтобы между ними установились отношения смежности.

Если для двух соседних маршрутизаторов используется одинаковый идентификатор маршрутизатора, в этом случае маршрутизатор выводит сообщение об ошибке, аналогичное следующему:

> %OSPF-4-DUP_RTRID1: обнаружен маршрутизатор с повторяющимся идентификатором.

Чтобы устранить эту проблему, настройте все маршрутизаторы с использованием уникальных идентификаторов маршрутизатора OSPF.

Идентификатор маршрутизатора также можно назначить, используя интерфейс loopback.

IPv4-адрес интерфейса loopback необходимо настроить, используя 32-битную маску подсети (255.255.255.255). Таким образом создаётся маршрут узла. 32-битный маршрут узла не объявляется в качестве маршрута для других маршрутизаторов OSPF.

> Примечание. Предпочтительнее использовать команду router-id. Но некоторые старые версии IOS не распознают команду  `router-id` , поэтому на этих маршрутизаторах лучше задавать идентификатор через интерфейс обратной петли.

##### Включение OSPF на интерфейсах

Команда **network** определяет, какие интерфейсы участвуют в процессе маршрутизации для области OSPFv2. Все интерфейсы на маршрутизаторе, соответствующие сетевому адресу в рамках команды **network**, включены и готовы к отправке и приёму пакетов OSPF. Команда **network** указывает адрес сети (или подсети) для интерфейса, включенного в обновления маршрутизации по протоколу OSPF.

Базовый синтаксис этой команды: 

    Router(config)# network адрес_сети шаблонная_маска область идентификатор области.

В команде **area** параметр *area-id* означает область протокола OSPF. При настройке конфигурации OSPFv2 для одной области команда **network** должна использоваться с одним и тем же значением *area-id* на всех маршрутизаторах. Несмотря на то что может использоваться любой идентификатор области, в случае OSPFv2 для одной области рекомендуется использовать идентификатор области 0. Применение этого соглашения упростит возможный в будущем переход на сеть с OSPFv2 для нескольких областей.

---


## Cписок используемой литературы

Открытые источники:

- [RFC 2178](https://tools.ietf.org/html/rfc2178)
- [RFC 2328](https://tools.ietf.org/html/rfc2328)
- [OSPF / xgu.ru](http://xgu.ru/wiki/OSPF#OSPF_.D0.B2_Cisco)
- [OSPF в Cisco / xgu.ru](http://xgu.ru/wiki/OSPF_%D0%B2_Cisco#.D0.9E.D0.BF.D0.B8.D1.81.D0.B0.D0.BD.D0.B8.D0.B5_.D1.80.D0.B0.D0.B1.D0.BE.D1.82.D1.8B_.D0.BF.D1.80.D0.BE.D1.82.D0.BE.D0.BA.D0.BE.D0.BB.D0.B0)
- [Протокол маршрутизации OSPF / ciscotips.ru](http://ciscotips.ru/ospf)
- [OSPF (часть первая) / habr.ru](https://habr.com/ru/post/418391/)
- [Руководство по проектированию OSPF / cisco.com](https://www.cisco.com/c/ru_ru/support/docs/ip/open-shortest-path-first-ospf/7039-1.html)

---

## License

ISC
